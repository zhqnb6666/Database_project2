<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transit Management System</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
<div class="container">
    <div class="d-flex justify-content-between align-items-center mt-5">
        <h1>Transit System Dashboard</h1>
        <button onclick="testConnection()" class="btn btn-secondary">Test Connection</button>
    </div>

    <!-- Navigation -->
    <ul class="nav nav-tabs" id="myTab" role="tablist">
        <li class="nav-item">
            <a class="nav-link active" id="stations-tab" data-toggle="tab" href="#stations" role="tab">Stations</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="lines-tab" data-toggle="tab" href="#lines" role="tab">Lines</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="ManageStationInLine-tab" data-toggle="tab" href="#ManageStationInLine" role="tab">Manage
                Station in the Line</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="search-tab" data-toggle="tab" href="#search" role="tab">Search</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="passenger-tab" data-toggle="tab" href="#passenger" role="tab">Board/Exit
                Passenger</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="cards-tab" data-toggle="tab" href="#cards" role="tab">Board/Exit Cards</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" id="search_board-tab" data-toggle="tab" href="#search_board" role="tab">Search Boarding
                Information</a>
        </li>
    </ul>

    <!-- Tab Content -->
    <div class="tab-content" id="myTabContent">
        <!-- Stations Tab -->
        <div class="tab-pane fade show active" id="stations" role="tabpanel">
            <h2 class="mt-4">Manage Stations</h2>
            <form id="stationForm">
                <!-- Station Details -->
                <div class="mb-3">
                    <label for="englishName" class="form-label">English Name</label>
                    <input type="text" id="englishName" class="form-control" placeholder="Enter English Name" required>
                </div>
                <div class="mb-3">
                    <label for="chineseName" class="form-label">Chinese Name</label>
                    <input type="text" id="chineseName" class="form-control" placeholder="Enter Chinese Name">
                </div>
                <div class="mb-3">
                    <label for="district" class="form-label">District</label>
                    <input type="text" id="district" class="form-control" placeholder="Enter District">
                </div>
                <div class="mb-3">
                    <label for="introduction" class="form-label">Introduction</label>
                    <textarea id="introduction" class="form-control" placeholder="Enter Introduction"></textarea>
                </div>
                <!-- Actions -->
                <button type="button" onclick="addStation()" class="btn btn-primary">Add Station</button>
                <button type="button" onclick="updateStation()" class="btn btn-success">Update Station</button>
            </form>
            <div id="stationResponse"></div>

            <!-- Delete Station Form -->
            <h3 class="mt-4">Delete Station</h3>
            <form id="deleteStationForm">
                <div class="mb-3">
                    <label for="deleteEnglishName" class="form-label">English Name</label>
                    <input type="text" id="deleteEnglishName" class="form-control"
                           placeholder="Enter English Name to delete" required>
                </div>
                <button type="button" onclick="deleteStation()" class="btn btn-danger">Delete Station</button>
            </form>
            <div id="deleteStationResponse"></div>
        </div>
        <!-- Line tab -->
        <div class="tab-pane fade" id="lines" role="tabpanel">
            <h2 class="mt-4">Manage Lines</h2>
            <!-- Form for Adding a New Line -->
            <form id="addLineForm" class="mb-4">
                <div class="form-group">
                    <label for="lineName">Line Name</label>
                    <input type="text" class="form-control" id="lineName" required>
                </div>
                <div class="form-group">
                    <label for="startTime">Start Time</label>
                    <input type="time" class="form-control" id="startTime" required>
                </div>
                <div class="form-group">
                    <label for="endTime">End Time</label>
                    <input type="time" class="form-control" id="endTime" required>
                </div>
                <div class="form-group">
                    <label for="lineIntro">Introduction</label>
                    <textarea class="form-control" id="lineIntro"></textarea>
                </div>
                <div class="form-group">
                    <label for="mileage">Mileage</label>
                    <input type="number" class="form-control" id="mileage" required>
                </div>
                <div class="form-group">
                    <label for="color">Color</label>
                    <input type="text" class="form-control" id="color" required>
                </div>
                <div class="form-group">
                    <label for="firstOpening">First Opening Date</label>
                    <input type="date" class="form-control" id="firstOpening" required>
                </div>
                <div class="form-group">
                    <label for="url">URL</label>
                    <input type="url" class="form-control" id="url">
                </div>
                <button type="button" onclick="addLine()" class="btn btn-primary">Add Line</button>
                <button type="button" onclick="updateLine()" class="btn btn-success">Update Line</button>
            </form>


            <!-- Form for Deleting a Line -->
            <form id="deleteLineForm">
                <div class="form-group">
                    <label for="deleteLineName">Line Name</label>
                    <input type="text" class="form-control" id="deleteLineName" required>
                </div>
                <button type="button" onclick="deleteLine()" class="btn btn-danger">Delete Line</button>
            </form>
        </div>

        <!-- Manage Station in the Line tab -->
        <div class="tab-pane fade" id="ManageStationInLine" role="tabpanel">
            <h2 class="mt-4">Manage Station in the Line</h2>
            <!-- Form for Adding a Station to a Line -->
            <form id="addStationToLineForm">
                <div class="form-group">
                    <label for="lineName2">Line Name</label>
                    <input type="text" class="form-control" id="lineName2" required>
                </div>
                <div class="form-group">
                    <label for="stationName">Station Name</label>
                    <input type="text" class="form-control" id="stationName" required>
                </div>
                <div class="form-group">
                    <label for="stationOrder">Station Order</label>
                    <input type="number" class="form-control" id="stationOrder" required>
                </div>
                <button type="button" onclick="addStationToLine(lineName2.value, stationName.value, stationOrder.value)"
                        class="btn btn-primary">Add Station to Line
                </button>
            </form>

            <!-- Form for Removing a Station from a Line -->
            <form id="removeStationFromLineForm">
                <div class="form-group">
                    <label for="removeLineName">Line Name</label>
                    <input type="text" class="form-control" id="removeLineName" required>
                </div>
                <div class="form-group">
                    <label for="removeStationName">Station Name</label>
                    <input type="text" class="form-control" id="removeStationName" required>
                </div>
                <button type="button" onclick="removeStationFromLine(removeLineName.value, removeStationName.value)"
                        class="btn btn-danger">Remove Station from Line
                </button>
            </form>
        </div>

        <!-- Search tab -->
        <div class="tab-pane fade" id="search" role="tabpanel">
            <h2 class="mt-4">Search Stations</h2>
            <form id="searchForm">
                <div class="form-group">
                    <label for="searchLineName">Line Name</label>
                    <input type="text" class="form-control" id="searchLineName" placeholder="Enter Line Name"
                           required>
                </div>
                <div class="form-group">
                    <label for="searchStationOrder">Station Order</label>
                    <input type="number" class="form-control" id="searchStationOrder" placeholder="Enter Station Order"
                           required>
                </div>
                <div class="form-group">
                    <label for="searchN">N (positions ahead and behind)</label>
                    <input type="number" class="form-control" id="searchN" placeholder="Enter N" required>
                </div>
                <button type="button" onclick="searchStations()" class="btn btn-info">Search Stations</button>
            </form>
            <div id="searchResults" class="mt-4"></div>
        </div>

        <!-- Boarding tab -->
        <div class="tab-pane fade" id="passenger" role="tabpanel">
            <h2 class="mt-4">Board and Exit Passengers</h2>

            <!-- Form for Boarding a Passenger -->
            <h3>Board Passenger</h3>
            <form id="boardPassengerForm">
                <label for="boardUserId"></label><input type="text" id="boardUserId" placeholder="User ID" required>
                <label for="boardStartStation"></label><input type="text" id="boardStartStation"
                                                              placeholder="Start Station" required>
                <button type="button" onclick="boardPassenger()" class="btn btn-primary">Board Passenger</button>
            </form>
            <div id="boardResponse" class="mt-3"></div>

            <!-- Form for Exiting a Passenger -->
            <h3>Exit Passenger</h3>
            <form id="exitPassengerForm">
                <label for="exitUserId"></label><input type="text" id="exitUserId" placeholder="User ID" required>
                <label for="exitStartStation"></label><input type="text" id="exitStartStation"
                                                             placeholder="Start Station" required>
                <label for="exitEndStation"></label><input type="text" id="exitEndStation" placeholder="End Station"
                                                           required>
                <button type="button" onclick="exitPassenger()" class="btn btn-success">Exit Passenger</button>
            </form>
            <div id="exitResponse" class="mt-3"></div>
        </div>
        <div class="tab-pane fade" id="cards" role="tabpanel">
            <h2 class="mt-4">Board and Exit Cards</h2>

            <!-- Form for Boarding a Card -->
            <h3>Board Card</h3>
            <form id="boardCardForm">
                <label for="boardCardId"></label><input type="text" id="boardCardId" placeholder="Card ID" required>
                <label for="boardCardStartStation"></label><input type="text" id="boardCardStartStation"
                                                                  placeholder="Start Station" required>
                <button type="button" onclick="boardCard()" class="btn btn-primary">Board Card</button>
            </form>
            <div id="boardCardResponse" class="mt-3"></div>

            <!-- Form for Exiting a Card -->
            <h3>Exit Card</h3>
            <form id="exitCardForm">
                <label for="exitCardId"></label><input type="text" id="exitCardId" placeholder="Card ID" required>
                <label for="exitCardStartStation"></label><input type="text" id="exitCardStartStation"
                                                                 placeholder="Start Station" required>
                <label for="exitCardEndStation"></label><input type="text" id="exitCardEndStation"
                                                               placeholder="End Station" required>
                <button type="button" onclick="exitCard()" class="btn btn-success">Exit Card</button>
            </form>
            <div id="exitCardResponse" class="mt-3"></div>
        </div>

        <!-- Search Board tab -->
        <div class="tab-pane fade" id="search_board" role="tabpanel">
            <h2 class="mt-4">Search Boarding Information</h2>

            <!-- Form for Searching Passenger Boarding Information -->
            <h3>Search Passenger</h3>
            <form id="searchPassengerForm">
                <label for="searchPassengerId"></label><input type="text" id="searchPassengerId"
                                                              placeholder="Passenger ID" required>
                <button type="button" onclick="searchPassenger()" class="btn btn-primary">Search Passenger</button>
            </form>
            <div id="searchPassengerResponse" class="mt-3"></div>

            <!-- Form for Searching Card Boarding Information -->
            <h3>Search Card</h3>
            <form id="searchCardForm">
                <label for="searchCardId"></label><input type="text" id="searchCardId" placeholder="Card ID" required>
                <button type="button" onclick="searchCard()" class="btn btn-primary">Search Card</button>
            </form>
            <div id="searchCardResponse" class="mt-3"></div>
        </div>


    </div>
</div>


<script>
    function addStation() {
        const englishName = document.getElementById('englishName').value;
        const chineseName = document.getElementById('chineseName').value;
        const district = document.getElementById('district').value;
        const introduction = document.getElementById('introduction').value;

        fetch('/stations', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                english_name: englishName,
                chinese_name: chineseName,
                district: district,
                intro: introduction
            })
        })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.message);
                    });
                }
                return response.json();
            })
            .then(data => {
                document.getElementById('stationResponse').innerText = 'Station added: ' + JSON.stringify(data);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('stationResponse').innerText = 'Failed to add the station.';
            });

    }

    function updateStation() {
        const englishName = document.getElementById('englishName').value;
        const chineseName = document.getElementById('chineseName').value;
        const district = document.getElementById('district').value;
        const introduction = document.getElementById('introduction').value;

        fetch(`/stations/${englishName}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                english_name: englishName,
                chinese_name: chineseName,
                district: district,
                intro: introduction
            })
        })
            .then(response => response.json())
            .then(data => {
                document.getElementById('stationResponse').innerText = 'Station updated: ' + JSON.stringify(data);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('stationResponse').innerText = 'Failed to update the station.';
            });
    }

    function deleteStation() {
        const englishName = document.getElementById('deleteEnglishName').value;

        fetch(`/stations/${englishName}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => response.json())
            .then(data => {
                document.getElementById('deleteStationResponse').innerText = 'Station deleted: ' + JSON.stringify(data);
            })
            .catch(error => {
                console.error('Error:', error);
                document.getElementById('deleteStationResponse').innerText = 'Failed to delete the station.';
            });
    }

    function addLine() {
        const data = {
            line_name: document.getElementById('lineName').value,
            start_time: document.getElementById('startTime').value,
            end_time: document.getElementById('endTime').value,
            intro: document.getElementById('lineIntro').value,
            mileage: document.getElementById('mileage').value,
            color: document.getElementById('color').value,
            first_opening: document.getElementById('firstOpening').value,
            url: document.getElementById('url').value
        };

        fetch('/lines', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        }).then(response => response.json())
            .then(data => alert('Line added: ' + data.message))
            .catch(error => alert('Failed to add line: ' + error));
    }

    function updateLine() {
        const lineName = document.getElementById('lineName').value;
        const data = {
            start_time: document.getElementById('startTime').value,
            end_time: document.getElementById('endTime').value,
            intro: document.getElementById('lineIntro').value,
            mileage: document.getElementById('mileage').value,
            color: document.getElementById('color').value,
            first_opening: document.getElementById('firstOpening').value,
            url: document.getElementById('url').value
        };

        fetch(`/lines/${lineName}`, {
            method: 'PUT',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(data)
        }).then(response => response.json())
            .then(data => alert('Line updated: ' + data.message + data.error))
            .catch(error => alert('Failed to update line: ' + error));
    }

    function deleteLine() {
        const lineName = document.getElementById('deleteLineName').value;

        fetch(`/lines/${lineName}`, {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => response.json())
            .then(data => {
                alert('Line deleted: ' + data.message);
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to delete the line.');
            });
    }

    function addStationToLine(lineName, stationName, stationOrder) {
        fetch('/line_stations', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                line_name: lineName,
                station_name: stationName,
                station_order: stationOrder
            })
        })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.message);
                    });
                }
                return response.json();
            })
            .then(data => alert('Station added: ' + data.message))
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to add station: ' + error);
            });
    }

    function removeStationFromLine(lineName, stationName) {
        fetch('/line_stations', {
            method: 'DELETE',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                line_name: lineName,
                station_name: stationName
            })
        })
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.message);
                    });
                }
                return response.json();
            })
            .then(data => alert('Station removed: ' + data.message))
            .catch(error => {
                console.error('Error:', error);
                alert('Failed to remove station: ' + error);
            });
    }

    function searchStations() {
        const lineName = document.getElementById('searchLineName').value;
        const stationOrder = document.getElementById('searchStationOrder').value;
        const n = document.getElementById('searchN').value;

        fetch(`/search_stations/${lineName}/${stationOrder}/${n}`)
            .then(response => {
                if (!response.ok) {
                    return response.json().then(err => {
                        throw new Error(err.message);
                    });
                }
                return response.json();
            })
            .then(data => {
                const resultsContainer = document.getElementById('searchResults');
                resultsContainer.innerHTML = '';

                const stationAhead = data.station_ahead ? `Station ahead: ${data.station_ahead}` : 'No station ahead found';
                const stationBehind = data.station_behind ? `Station behind: ${data.station_behind}` : 'No station behind found';

                resultsContainer.innerHTML = `<p>${stationAhead}</p><p>${stationBehind}</p>`;
            })
            .catch(error => {
                const resultsContainer = document.getElementById('searchResults');
                resultsContainer.innerHTML = `<p>Error: ${+error.error}</p>`;
            });
    }


    function boardPassenger() {
        const userId = document.getElementById('boardUserId').value;
        const startStation = document.getElementById('boardStartStation').value;

        fetch('/board_passenger', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                user_id: userId,
                start_station: startStation
            })
        }).then(response => {
            if (!response.ok) {
                return response.json().then(err => {
                    throw new Error(err.message);
                });
            }
            return response.json();
        })
            .then(data => {
                document.getElementById('boardResponse').textContent = 'Passenger boarded: ' + data.message;
            })
            .catch(error => {
                document.getElementById('boardResponse').textContent = 'Failed to board passenger: ' + error;
            });
    }

    function exitPassenger() {
        const userId = document.getElementById('exitUserId').value;
        const startStation = document.getElementById('exitStartStation').value;
        const endStation = document.getElementById('exitEndStation').value;

        fetch('/exit_passenger', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                user_id: userId,
                start_station: startStation,
                end_station: endStation
            })
        }).then(response => response.json())
            .then(data => {
                document.getElementById('exitResponse').textContent = 'Passenger exited: ' + data.message + ', Price: ' + data.price;
            })
            .catch(error => {
                document.getElementById('exitResponse').textContent = 'Failed to exit passenger: ' + error.error;
            });
    }

    function boardCard() {
        const cardId = document.getElementById('boardCardId').value;
        const startStation = document.getElementById('boardCardStartStation').value;

        fetch('/board_card', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                user_id: cardId,
                start_station: startStation
            })
        }).then(response => response.json())
            .then(data => {
                document.getElementById('boardCardResponse').textContent = 'Card boarded: ' + data.message;
            })
            .catch(error => {
                document.getElementById('boardCardResponse').textContent = 'Failed to board card: ' + error.error;
            });
    }

    function exitCard() {
        const cardId = document.getElementById('exitCardId').value;
        const startStation = document.getElementById('exitCardStartStation').value;
        const endStation = document.getElementById('exitCardEndStation').value;

        fetch('/exit_card', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                user_id: cardId,
                start_station: startStation,
                end_station: endStation
            })
        }).then(response => response.json())
            .then(data => {
                document.getElementById('exitCardResponse').textContent = 'Card exited: ' + data.message + ', Price: ' + data.price;
            })
            .catch(error => {
                document.getElementById('exitCardResponse').textContent = 'Failed to exit card: ' + error.error;
            });
    }

    function searchPassenger() {
        const passengerId = document.getElementById('searchPassengerId').value;

        fetch(`/search_passenger/${passengerId}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('searchPassengerResponse').textContent = 'Passenger boarding info: ' + JSON.stringify(data);
            })
            .catch(error => {
                document.getElementById('searchPassengerResponse').textContent = 'Failed to search passenger: ' + error.error;
            });
    }

    function searchCard() {
        const cardId = document.getElementById('searchCardId').value;

        fetch(`/search_card/${cardId}`)
            .then(response => response.json())
            .then(data => {
                document.getElementById('searchCardResponse').textContent = 'Card boarding info: ' + JSON.stringify(data);
            })
            .catch(error => {
                document.getElementById('searchCardResponse').textContent = 'Failed to search card: ' + error.error;
            });
    }

    function testConnection() {
        fetch('http://localhost:5000/test_connection', {
            method: 'GET',
            headers: {
                'Content-Type': 'application/json'
            }
        })
            .then(response => {
                if (response.ok) {
                    alert('Connection successful!');
                } else {
                    throw new Error('Connection failed!');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Connection failed: ' + error.error);
            });
    }


</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
</body>
</html>
